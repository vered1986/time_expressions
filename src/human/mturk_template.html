<!-- You must include this JavaScript file -->
<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- For the full list of available Crowd HTML Elements and their input/output documentation,
      please refer to https://docs.aws.amazon.com/sagemaker/latest/dg/sms-ui-template-reference.html -->

<!-- You must include crowd-form so that your task submits answers to MTurk -->
<crowd-form answer-format="flatten-objects" onsubmit="validate()">

    <crowd-instructions link-text="View instructions" link-type="button">
        <short-summary>
            <p>Please answer the following questions about your interpretation of time expressions.</p>
        </short-summary>

        <detailed-instructions>
            <p>Please answer the following questions about your interpretation of time expressions, for example, the
                time of the day you would consider as morning.</p>
            <ul>
                <li>The questions are in English but referring to your native language. For each time expression (e.g. morning),
                you need to specify the equivalent word in your native language, and the range of hours in the day.</li>
                <li>The ranges for different time expressions may overlap and don't necessarily need to cover all 24 hours.</li>
                <li>If your native language is not on the list, please select English and leave a comment with your native language.</li>
            </ul>
        </detailed-instructions>

        <positive-example>
		    <p>
		    	<ol>
                    <li><b>What is your native language?</b> Italian</li>
		    		<li><b>What is the equivalent word for <span style="color:blue">morning</span> in your native language?</b> mattina</li>
                    <li><b>What is the range of time you consider as <span style="color:blue">morning</span>? 6 AM to 10 AM</b></li>
		    	</ol>
		    </p>
            Note that this is just my interpretation! You can use any other times.
		  </positive-example>
    </crowd-instructions>

    <div>
        <label for="lang">What is your native language?</label>
        <select id="lang" name="lang" onchange="lang_changed(this)" required>
            <option value="">Select language...</option>
            <option value="AF">Afrikaans</option>
            <option value="SQ">Albanian</option>
            <option value="AR">Arabic</option>
            <option value="HY">Armenian</option>
            <option value="EU">Basque</option>
            <option value="BN">Bengali</option>
            <option value="BG">Bulgarian</option>
            <option value="CA">Catalan</option>
            <option value="KM">Cambodian</option>
            <option value="ZH">Chinese (Mandarin)</option>
            <option value="HR">Croatian</option>
            <option value="CS">Czech</option>
            <option value="DA">Danish</option>
            <option value="NL">Dutch</option>
            <option value="EN">English</option>
            <option value="ET">Estonian</option>
            <option value="FJ">Fiji</option>
            <option value="FI">Finnish</option>
            <option value="FR">French</option>
            <option value="KA">Georgian</option>
            <option value="DE">German</option>
            <option value="EL">Greek</option>
            <option value="GU">Gujarati</option>
            <option value="HE">Hebrew</option>
            <option value="HI">Hindi</option>
            <option value="HU">Hungarian</option>
            <option value="IS">Icelandic</option>
            <option value="ID">Indonesian</option>
            <option value="GA">Irish</option>
            <option value="IT">Italian</option>
            <option value="JA">Japanese</option>
            <option value="JW">Javanese</option>
            <option value="KO">Korean</option>
            <option value="LA">Latin</option>
            <option value="LV">Latvian</option>
            <option value="LT">Lithuanian</option>
            <option value="MK">Macedonian</option>
            <option value="MS">Malay</option>
            <option value="ML">Malayalam</option>
            <option value="MT">Maltese</option>
            <option value="MI">Maori</option>
            <option value="MR">Marathi</option>
            <option value="MN">Mongolian</option>
            <option value="NE">Nepali</option>
            <option value="NO">Norwegian</option>
            <option value="FA">Persian</option>
            <option value="PL">Polish</option>
            <option value="PT">Portuguese</option>
            <option value="PA">Punjabi</option>
            <option value="QU">Quechua</option>
            <option value="RO">Romanian</option>
            <option value="RU">Russian</option>
            <option value="SM">Samoan</option>
            <option value="SR">Serbian</option>
            <option value="SK">Slovak</option>
            <option value="SL">Slovenian</option>
            <option value="ES">Spanish</option>
            <option value="SW">Swahili</option>
            <option value="SV">Swedish</option>
            <option value="TA">Tamil</option>
            <option value="TT">Tatar</option>
            <option value="TE">Telugu</option>
            <option value="TH">Thai</option>
            <option value="BO">Tibetan</option>
            <option value="TO">Tonga</option>
            <option value="TR">Turkish</option>
            <option value="UK">Ukrainian</option>
            <option value="UR">Urdu</option>
            <option value="UZ">Uzbek</option>
            <option value="VI">Vietnamese</option>
            <option value="CY">Welsh</option>
            <option value="XH">Xhosa</option>
        </select>
    </div>

    <br/><hr/>

    <p>
        <label for="morning_translation">What is the equivalent word for <span style="color:blue"><b>morning</b></span> in your native language?</label>
        <input type="text" id="morning_translation" name="morning_translation" required>
        <br/><br/>
        <label for="morning_start">What is the range of time you consider as <span style="color:blue"><b>morning</b></span>?</label>
        <input type="time" id="morning_start" name="morning_start" required>&nbsp;to&nbsp;<input type="time" id="morning_end" name="morning_end" required>
        <br/><br/>
        <crowd-checkbox id="no_eq_morning" name="no_eq_morning" onchange="equiv_expr_changed(this)">There is no equivalent expression for <span style="color:blue"><b>morning</b></span> in my native language.</crowd-checkbox>
    </p>

    <hr/><br/>

    <p>
        <label for="noon_translation">What is the equivalent word for <span style="color:blue"><b>noon</b></span> in your native language?</label>
        <input type="text" id="noon_translation" name="noon_translation" required>
        <br/><br/>
        <label for="noon_start">What is the range of time you consider as <span style="color:blue"><b>noon</b></span>?</label>
        <input type="time" id="noon_start" name="noon_start" required>&nbsp;to&nbsp;<input type="time" id="noon_end" name="noon_end" required>
        <br/><br/>
        <crowd-checkbox id="no_eq_noon" name="no_eq_noon" onchange="equiv_expr_changed(this)">There is no equivalent expression for <span style="color:blue"><b>noon</b></span> in my native language.</crowd-checkbox>
    </p>

    <hr/><br/>

    <p>
        <label for="afternoon_translation">What is the equivalent word for <span style="color:blue"><b>afternoon</b></span> in your native language?</label>
        <input type="text" id="afternoon_translation" name="afternoon_translation" required>
        <br/><br/>
        <label for="afternoon_start">What is the range of time you consider as <span style="color:blue"><b>afternoon</b></span>?</label>
        <input type="time" id="afternoon_start" name="afternoon_start" required>&nbsp;to&nbsp;<input type="time" id="afternoon_end" name="afternoon_end" required>
        <br/><br/>
        <crowd-checkbox id="no_eq_afternoon" name="no_eq_afternoon" onchange="equiv_expr_changed(this)">There is no equivalent expression for <span style="color:blue"><b>afternoon</b></span> in my native language.</crowd-checkbox>
    </p>

    <hr/><br/>

    <p>
        <label for="evening_translation">What is the equivalent word for <span style="color:blue"><b>evening</b></span> in your native language?</label>
        <input type="text" id="evening_translation" name="evening_translation" required>
        <br/><br/>
        <label for="evening_start">What is the range of time you consider as <span style="color:blue"><b>evening</b></span>?</label>
        <input type="time" id="evening_start" name="evening_start" required>&nbsp;to&nbsp;<input type="time" id="evening_end" name="evening_end" required>
        <br/><br/>
        <crowd-checkbox id="no_eq_evening" name="no_eq_evening" onchange="equiv_expr_changed(this)">There is no equivalent expression for <span style="color:blue"><b>evening</b></span> in my native language.</crowd-checkbox>
    </p>

    <hr/><br/>

    <p>
        <label for="night_translation">What is the equivalent word for <span style="color:blue"><b>night</b></span> in your native language?</label>
        <input type="text" id="night_translation" name="night_translation" required>
        <br/><br/>
        <label for="night_start">What is the range of time you consider as <span style="color:blue"><b>night</b></span>?</label>
        <input type="time" id="night_start" name="night_start" required>&nbsp;to&nbsp;<input type="time" id="night_end" name="night_end" required>
        <br/><br/>
        <crowd-checkbox id="no_eq_night" name="no_eq_night" onchange="equiv_expr_changed(this)">There is no equivalent expression for <span style="color:blue"><b>night</b></span> in my native language.</crowd-checkbox>
    </p>

    <hr/><br/>

    <div>
        <p><b>Optional:</b> If there is another time expression in your native language that wasn't mentioned here?</p>
        <label for="other_source">Expression (in your native language):</label> <input type="text" id="other_source" name="other_source">&nbsp;
        <label for="other_translation">Its English translation:</label> <input type="text" id="other_translation" name="other_translation"><br/><br/>
        <label for="other_start">Time range:</label>
        <input type="time" id="other_start" name="other_start">&nbsp;to&nbsp;<input type="time" id="other_end" name="other_end">
    </div>

    <hr/><br/>

    <div>
        <p><b>Optional:</b> Do you have any comments?</p>
        <crowd-text-area name="comment" rows="3"></crowd-text-area>
    </div>
</crowd-form>

<script>

    document.querySelector('crowd-form').onsubmit = function(e) {
        if (!validateForm()) {
            alert("Please complete at least 3 time expressions");
            e.preventDefault();
        }
    }

    function validateForm() {
        // Make sure not more than 2 of the "no equal translation"
        // checkboxes are checked
        var checked = 0;

        ["morning", "noon", "afternoon", "evening", "night"].forEach(function (time_exp) {
            no_eq = $("#" + "no_eq_" + time_exp)[0];
            if (no_eq.checked) {
                checked++;
            }
        });

        return (checked <= 2);
    }

    function equiv_expr_changed(chkbox) {
        var time_exp = chkbox.id.replace("no_eq_", "");

        ["translation", "start", "end"].forEach(function(name) {
            curr_input = $("#" + time_exp + "_" + name)[0];
            curr_input.required = !chkbox.checked;
            curr_input.disabled = chkbox.checked;
        });
    }

    function lang_changed(dropdown) {
        // If English: populate and disable the translation
        // inputs, and disable the "no translation" checkbox
        if (dropdown.value === "EN") {
            ["morning", "noon", "afternoon", "evening", "night"].forEach(function (time_exp) {
                translation = $("#" + time_exp + "_translation")[0];
                translation.value = time_exp;
                translation.disabled = true;

                no_eq = $("#" + "no_eq_" + time_exp)[0];
                no_eq.checked = false;
                no_eq.disabled = true;

                start = $("#" + time_exp + "_start")[0];
                start.disabled = false;
                start.required = true;

                end = $("#" + time_exp + "_end")[0];
                end.disabled = false;
                end.required = true;
            });
        } else {
            ["morning", "noon", "afternoon", "evening", "night"].forEach(function (time_exp) {
                translation = $("#" + time_exp + "_translation")[0];
                translation.value = "";
                translation.disabled = false;

                no_eq = $("#" + "no_eq_" + time_exp)[0];
                no_eq.checked = false;
                no_eq.disabled = false;

                start = $("#" + time_exp + "_start")[0];
                start.disabled = no_eq.checked;
                start.required = !no_eq.checked;

                end = $("#" + time_exp + "_end")[0];
                end.disabled = no_eq.checked;
                end.required = !no_eq.checked;
            });
        }
    }
</script>
